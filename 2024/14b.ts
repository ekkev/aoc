import { File, globalProtos } from "./lib/index.ts";
import { xyadd } from "./lib/matrix.ts";
import { M, X, XY, Y, matrixCreate, matrixGet, matrixPrint, matrixSet } from "./lib/matrix.ts";
globalProtos();

const robots = File.numberTable("14.in");

const W = 101, H = 103;
let maxdiag = 0, cm: M|undefined, res = 0;

let C = 1;
while (C++) {
  const ends: XY[] = robots.map(([x, y, vx, vy]) => [((x + vx * C) % W + W) % W, ((y + vy * C) % H + H) % H]);

  if (robots.every(([x,y], i) => x === ends[i][X] && y === ends[i][Y])){
    console.log('cycle', {C});
    break;
  }

  const m = matrixCreate(W, H);
  ends.forEach(pos => matrixSet(m, pos, 'X'))
  const diags = ends.count((pos) => matrixGet(m, xyadd(pos, [1, 1])) === 'X');
  if (diags > maxdiag) {
    maxdiag = diags;
    res = C;
    cm = m;
  }
}

cm && matrixPrint(cm);
console.log({  res }); // 7502

/**
.................X...................................................................................
....................................X...............XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..................
..................X..................X............X.X.............................X..................
.......X............................................X.............................X..XX..............
....................................................X.............................X..................
.......X........................X...................X.............................X..................
....................................................X..............X..............X..............X...
.................X..................................X.............XXX.............X..................
........X...........................................X............XXXXX............X...X..............
....................................................X...........XXXXXXX...........X..................
....................................................X..........XXXXXXXXX..........X...X..............
....................................................X............XXXXX............X..................
....................................................X...........XXXXXXX...........X.......X..........
.....................X..............................X..........XXXXXXXXX..........X.................X
....................................................X.........XXXXXXXXXXX.........X..................
......X.............................................X........XXXXXXXXXXXXX........X..................
............................................X.......X..........XXXXXXXXX..........X..................
....................................................X.........XXXXXXXXXXX.........X..................
....................................................X........XXXXXXXXXXXXX........X..................
....................................................X.......XXXXXXXXXXXXXXX.......X..................
....................................................X......XXXXXXXXXXXXXXXXX......X..................
....................................................X........XXXXXXXXXXXXX........X..................
....................................................X.......XXXXXXXXXXXXXXX.......X..................
....................................................X......XXXXXXXXXXXXXXXXX......X..................
...........X..........................X.............X.....XXXXXXXXXXXXXXXXXXX.....X..................
.......X...X........................................X....XXXXXXXXXXXXXXXXXXXXX....X..................
....................................................X.............XXX.............X..................
.........X......................................X...X.............XXX.............X..................
...................................X................X.............XXX.............X..................
....................................................X.............................X.......X..........
......X...X.........................................X.............................X..................
.....................X..............................X.............................X..................
.............................X......................X.............................X..................
.................................X.........X........XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..................
............X....................................X..........................................X....X...
 */